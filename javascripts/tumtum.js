(function(){$(function(){var t,e,r,a,n,o,i,s,u,d,c,h,l,g,D,w,y,f,p,x,C,m,B,b,S,A,v,F,j,k;if(g=$("canvas#tumtum")[0]){for(r=10,S=.1,b=.35,C=!1,D=!1,F=new createjs.Stage(g),a=new createjs.Container,m=new createjs.Container,F.addChild(a),l=[],c=Box2D.Common.Math.b2Vec2,o=Box2D.Dynamics.b2BodyDef,n=Box2D.Dynamics.b2Body,u=Box2D.Dynamics.b2FixtureDef,h=Box2D.Dynamics.b2World,d=Box2D.Collision.Shapes.b2PolygonShape,i=Box2D.Collision.Shapes.b2CircleShape,s=Box2D.Dynamics.b2DebugDraw,w=$(g),f=new c(w.data("gravity-x"),w.data("gravity-y")),k=new h(f,!0),e=g.width,j=g.width/e,p=g.height/e,y=new u,y.density=1,t=$("#arts-count"),function(){var t,e;return t=new o,t.type=n.b2_staticBody,y.shape=new d,e=.1,t.position.Set(j/2,-e),y.shape.SetAsBox(j/2,e),k.CreateBody(t).CreateFixture(y),t.position.Set(-e,100*p/2),y.shape.SetAsBox(e,100*p/2),k.CreateBody(t).CreateFixture(y),t.position.Set(j+e,100*p/2),y.shape.SetAsBox(e,100*p/2),k.CreateBody(t).CreateFixture(y)}(),g.showArtsCount=function(){return t.text(l.length)},g.addActors=function(t){var e,r;return r=l.slice().sort(function(t,e){return-(t.radius-e.radius)}),e=r.indexOf(t),a.addChildAt(t.actors[0],e),m.addChildAt(t.actors[1],e)},g.addArt=function(){var t,r,a;return a=Math.random()*(b-S)+S,r=new o,r.type=n.b2_dynamicBody,y.shape=new i(.8*a),r.position.Set(j*(.1+.8*Math.random()),p+Math.random()),t=k.CreateBody(r),t.CreateFixture(y),l.push(t),t.radius=a,t.actors=[new ArtImage(a*e),new Baumkuchen(a*e)],g.addActors(t),g.showArtsCount()},g.addArt10=function(){var t,e,r;for(r=[],t=e=1;10>=e;t=++e)r.push(g.addArt());return r},g.toggleImages=function(){return C=!C,C?(a.remove(),F.addChildAt(m,0)):(F.addChildAt(a,0),m.remove()),C},g.toggleDebug=function(){return D=!D,D&&!this.debugDraw&&(this.debugDraw=new s,this.debugDraw.SetSprite(g.getContext("2d")),this.debugDraw.SetDrawScale(e),this.debugDraw.SetFillAlpha(.3),this.debugDraw.SetLineThickness(1),this.debugDraw.SetFlags(s.e_shapeBit|s.e_jointBit),k.SetDebugDraw(this.debugDraw)),D},g.reset=function(){var t,e,r;for(e=0,r=l.length;r>e;e++)t=l[e],k.DestroyBody(t),a.removeChild(t.actors[0]),m.removeChild(t.actors[1]);return l=[],g.showArtsCount(),!1},g.dump=function(){var t,e,r;return r=function(){var e,r,a;for(a=[],e=0,r=l.length;r>e;e++)t=l[e],a.push({x:t.GetPosition().x,y:t.GetPosition().y,radius:t.radius});return a}(),e={count:r.length,elements:r},$("#output").text(JSON.stringify(e))},createjs.Ticker.timingMode=createjs.Ticker.RAF,createjs.Ticker.addEventListener("tick",function(t){var r,a,n,o,i,s,u,d;if(k.Step(1/60,3,3),k.ClearForces(),D)return k.DrawDebugData();for(n=0,i=l.length;i>n;n++)if(a=l[n],u=a.GetPosition(),u&&null!=u.x&&null!=u.y)for(d=a.actors,o=0,s=d.length;s>o;o++)r=d[o],r.x=u.x*e,r.y=u.y*e;return F.update(t)}),v=[],x=B=0,A=r;A>=0?A>B:B>A;x=A>=0?++B:--B)v.push(g.addArt());return v}})}).call(this);