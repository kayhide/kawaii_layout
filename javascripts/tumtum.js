(function(){$(function(){var e,t,n,r,a,o,i,s,u,d,c,h,l,w,y,g,p,D,f,B,x,m,v,b,C,S,A,F,G,M,T,j,k,P,J,L,_,E,O,N;if(p=$("canvas#tumtum")[0]){for(n=10,T=!1,D=!1,E=new createjs.Stage(p),r=new createjs.Container,j=new createjs.Container,E.addChild(r),y=[],l=Box2D.Common.Math.b2Vec2,i=Box2D.Dynamics.b2BodyDef,o=Box2D.Dynamics.b2Body,d=Box2D.Dynamics.b2FixtureDef,w=Box2D.Dynamics.b2World,h=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2CircleShape,u=Box2D.Dynamics.b2DebugDraw,a=Box2D.Collision.b2AABB,c=Box2D.Dynamics.Joints.b2MouseJointDef,f=$(p),C=new l(f.data("gravity-x"),f.data("gravity-y")),N=new w(C,!0),t=p.width,O=p.width/t,G=p.height/t,B=new d,B.density=1,e=$("#arts-count"),J=new l,P=null,b=function(){return parseFloat($("#radius-min").val())},v=function(){return parseFloat($("#radius-max").val())},m=function(){return parseFloat($("#body-ratio").val())},g=function(){var e,t,n,r,a,s;return e=new i,e.type=o.b2_staticBody,g=N.CreateBody(e),r=.1,s=100*G,a=new d,a.shape=new h,a.shape.SetAsOrientedBox(O/2,r,new l(O/2,-r),0),t=new d,t.shape=new h,t.shape.SetAsOrientedBox(r,s,new l(-r,0),0),n=new d,n.shape=new h,n.shape.SetAsOrientedBox(r,s,new l(O+r,0),0),g.CreateFixture(a),g.CreateFixture(t),g.CreateFixture(n),g}(),S=function(e){var n,r,a,o;a=e.stageX,o=e.stageY,J.Set(a/t,o/t),r=x(),r&&(n=new c,n.bodyA=g,n.bodyB=r,n.target=J,n.collideConnected=!0,n.maxForce=1e3*r.GetMass(),n.dampingRatio=0,P=N.CreateJoint(n),r.SetAwake(!0))},A=function(e){var n,r;n=e.stageX,r=e.stageY,J.Set(n/t,r/t),P&&P.SetTarget(J)},F=function(e){this.onMouseMove=this.onMouseUp=null,P&&(N.DestroyJoint(P),P=!1)},x=function(e){var t,n,r;return n=null,t=new a,r=function(t){var r,a;return a=t.GetShape(),(t.GetBody().GetType()!==o.b2_staticBody||e)&&(r=a.TestPoint(t.GetBody().GetTransform(),J))?(n=t.GetBody(),!1):!0},t.lowerBound.Set(J.x-.001,J.y-.001),t.upperBound.Set(J.x+.001,J.y+.001),N.QueryAABB(r,t),n},p.showArtsCount=function(){return e.text(y.length)},p.addActors=function(e){return r.addChild(e.actors[0]),j.addChild(e.actors[1])},p.addArt=function(){var e,n,r,a,u,d,c,h;return d=Math.random()*(v()-b())+b(),a=new i,a.type=o.b2_dynamicBody,B.shape=new s(m()*d),h=function(){var e,t,n;for(n=[],e=0,t=y.length;t>e;e++)r=y[e],NaN!==r.GetPosition().y&&n.push(r.GetPosition().y+r.radius);return n}(),c=h.length>0?Math.max.apply(null,h):d,a.position.Set(O*(.1+.8*Math.random()),c),r=N.CreateBody(a),r.CreateFixture(B),u=y.push(r),r.radius=d,e=new ArtImage(d*t,u),e.addEventListener("mousedown",S),e.addEventListener("pressmove",A),e.addEventListener("pressup",F),n=new Baumkuchen(d*t),r.actors=[e,n],p.addActors(r),p.showArtsCount()},p.addArt10=function(){var e,t,n;for(n=[],e=t=1;10>=t;e=++t)n.push(p.addArt());return n},p.toggleImages=function(){return T=!T,T?(r.remove(),E.addChildAt(j,0)):(E.addChildAt(r,0),j.remove()),T},p.toggleDebug=function(){return D=!D,D&&!this.debugDraw&&(this.debugDraw=new u,this.debugDraw.SetSprite(p.getContext("2d")),this.debugDraw.SetDrawScale(t),this.debugDraw.SetFillAlpha(.3),this.debugDraw.SetLineThickness(1),this.debugDraw.SetFlags(u.e_shapeBit|u.e_jointBit),N.SetDebugDraw(this.debugDraw)),D},p.reset=function(){var e,t,n;for(t=0,n=y.length;n>t;t++)e=y[t],N.DestroyBody(e),r.removeChild(e.actors[0]),j.removeChild(e.actors[1]);return y=[],p.showArtsCount(),!1},p.dump=function(){var e,t,n;return n=function(){var t,n,r;for(r=[],t=0,n=y.length;n>t;t++)e=y[t],r.push({x:e.GetPosition().x,y:e.GetPosition().y,radius:e.radius});return r}(),t={count:n.length,elements:n},$("#output").text(JSON.stringify(t))},createjs.Ticker.timingMode=createjs.Ticker.RAF,createjs.Ticker.addEventListener("tick",function(e){var n,r,a,o,i,s,u,d;if(N.Step(1/60,3,3),N.ClearForces(),D)return N.DrawDebugData();for(a=0,i=y.length;i>a;a++)if(r=y[a],u=r.GetPosition(),u&&null!=u.x&&null!=u.y)for(d=r.actors,o=0,s=d.length;s>o;o++)n=d[o],n.x=u.x*t,n.y=u.y*t;return E.update(e)}),_=[],M=k=0,L=n;L>=0?L>k:k>L;M=L>=0?++k:--k)_.push(p.addArt());return _}})}).call(this);