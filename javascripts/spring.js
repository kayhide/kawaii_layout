(function(){$(function(){var e,t,r,a,n,o,i,d,s,c,l,h,u,f,g,v,y,m,j,p,w,x,A;if(s=$("canvas#spring")[0]){for(t=6,o=3,n=1.2,a=.05,w=0,h=.9,j=40,m=80,g=!1,c=!1,l=$(s),u=new createjs.Point(l.data("gravity-x"),l.data("gravity-y")),A=new createjs.Stage(s),r=new createjs.Container,v=new createjs.Container,d=new createjs.Container,A.addChild(r),e=[],i=[],s.addActors=function(t){var a,n;return n=e.slice().sort(function(e,t){return-(e.radius-t.radius)}),a=n.indexOf(t),r.addChildAt(t.actors[0],a),v.addChildAt(t.actors[1],a)},s.addArt=function(){var t,r,a,n,i,d,c,l;for(i=Math.floor(Math.random()*(m-j)+j),t={radius:i,x:s.width*(.5+.4*Math.random()-.2),y:(null!=(d=null!=(c=e[e.length-1])?c.y:void 0)?d:0)+i,mass:Math.max(1,o-e.length),velocity:new createjs.Point(0,0),force:new createjs.Point(0,0),actors:[new Baumkuchen(i),new ArtImage(i)],position:function(){return new createjs.Point(this.x,this.y)}},l=e.slice(Math.max(0,e.length-o)),a=0,n=l.length;n>a;a++)r=l[a],s.addBondFor(t,r);return e.push(t),s.addActors(t),t},s.toggleImages=function(){return g=!g,g?(r.remove(),A.addChildAt(v,0)):(A.addChildAt(r,0),v.remove()),g},s.toggleDebug=function(){return c=!c,c?A.addChild(d):d.remove(),c},s.addBondFor=function(e,t){var r;return r=new createjs.Shape,i.push({arts:[e,t],length:(e.radius+t.radius)*n,shape:r}),d.addChild(r)},createjs.Ticker.timingMode=createjs.Ticker.RAF,createjs.Ticker.addEventListener("tick",function(t){var r,n,o,d,s,l,f,g,v,y,m,j,p,x,C,k,M,P,T,S,b;for(g=0,j=i.length;j>g;g++)s=i[g],o=s.arts[0],d=s.arts[1],b=d.position().subtract(o.position()),m=b.length(),l=b.scale(1/m),f=l.scale(-w/m*m+(m-s.length)*a),o.force=o.force.add(f),d.force=d.force.add(f.scale(-1));for(v=0,p=e.length;p>v;v++)n=e[v],n.force=n.force.add(u),n.velocity=n.velocity.add(n.force).scale(1/n.mass*h),n.force=new createjs.Point(0,0);for(y=0,x=e.length;x>y;y++)for(n=e[y],T=n.position().add(n.velocity),n.x=T.x,n.y=T.y,S=n.actors,M=0,C=S.length;C>M;M++)r=S[M],r.x=n.x,r.y=n.y;if(c)for(P=0,k=i.length;k>P;P++)s=i[P],s.shape.graphics.clear().beginStroke("#333").moveTo(s.arts[0].x,s.arts[0].y).lineTo(s.arts[1].x,s.arts[1].y).endStroke();return A.update(t)}),x=[],f=y=0,p=t;p>=0?p>y:y>p;f=p>=0?++y:--y)x.push(s.addArt());return x}})}).call(this);